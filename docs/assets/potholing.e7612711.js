import{h as U,F as G,o as K,c as Q,w as H,b as N,d as F}from"./index.45e6b93c.js";import{E as X}from"./el-button.14dba0ef.js";import{E as Y}from"./el-input.5a29a354.js";import{_ as Z}from"./OperateBox.60421fe4.js";class ${constructor(e,i){this.viewer=e,this.config=i,this.analysis()}analysis(){var e=this.viewer,i=this.config,r=e.scene.globe.ellipsoid,t=i.positions,m=[],u=[];t.forEach(o=>{var w=Cesium.Cartographic.fromCartesian(o),p=Number(w.height.toFixed(2)),M=r.cartesianToCartographic({x:o.x,y:o.y,z:o.z}),y=Cesium.Math.toDegrees(M.latitude),g=Cesium.Math.toDegrees(M.longitude);m.push({x:g,y,z:p}),u.push({x:g,y,z:p})});var s=r.cartesianToCartographic({x:t[0].x,y:t[0].y,z:t[0].z}),h=Cesium.Cartographic.fromCartesian(t[0]),n=Number(h.height.toFixed(2)),C=Cesium.Math.toDegrees(s.latitude),d=Cesium.Math.toDegrees(s.longitude);u.push({x:d,y:C,z:n}),this.excavate(m,u)}excavate(e,i){var r=this.viewer,t=this.config,m=this;r.scene.globe.ellipsoid;var u=[],s=[],h=m.isClockWise(e);h===!0&&(e.reverse(),i.reverse()),e.forEach(a=>{u.push(a.x),u.push(a.y),s.push(a.z)});var n=[];e.forEach(a=>{n.push(Cesium.Cartesian3.fromDegrees(a.x,a.y))});for(var C=n.length,d=[],o=0;o<C;++o){var w=(o+1)%C,p=Cesium.Cartesian3.add(n[o],n[w],new Cesium.Cartesian3);p=Cesium.Cartesian3.multiplyByScalar(p,.5,p);var M=Cesium.Cartesian3.normalize(p,new Cesium.Cartesian3),y=Cesium.Cartesian3.subtract(n[w],p,new Cesium.Cartesian3);y=Cesium.Cartesian3.normalize(y,y);var g=Cesium.Cartesian3.cross(y,M,new Cesium.Cartesian3);g=Cesium.Cartesian3.normalize(g,g);var W=new Cesium.Plane(g,0),q=Cesium.Plane.getPointDistance(W,p);d.push(new Cesium.ClippingPlane(g,q))}r.scene.globe.clippingPlanes=new Cesium.ClippingPlaneCollection({planes:d,edgeWidth:1,edgeColor:Cesium.Color.OLIVE});try{r.entities.removeById("entityDM"),r.entities.removeById("entityDMBJ")}catch{}for(var S,o=0;o<s.length;o++)for(var x=o;x<s.length;x++)s[o]>s[x]&&(S=s[x],s[x]=s[o],s[o]=S);r.entities.add({id:"entityDM",polygon:{hierarchy:Cesium.Cartesian3.fromDegreesArray(u),material:new Cesium.ImageMaterialProperty({image:t.bottom,color:new Cesium.Color.fromCssColorString("#cbc6c2"),repeat:new Cesium.Cartesian2(30,30)}),height:s[0]-t.height}});var _=[],D=[],P=[],v=2048,f=[];if(i.forEach((a,c)=>{if(c<i.length-1)for(var b=Cesium.Math.toRadians(a.x),z=Cesium.Math.toRadians(i[c+1].x),B=Cesium.Math.toRadians(a.y),E=Cesium.Math.toRadians(i[c+1].y),l=0;l<v;++l){var R=Cesium.Math.lerp(a.x,i[c+1].x,l/(v-1)),T=Cesium.Math.lerp(a.y,i[c+1].y,l/(v-1)),I=Cesium.Math.lerp(b,z,l/(v-1)),V=Cesium.Math.lerp(B,E,l/(v-1)),k=new Cesium.Cartographic(I,V);P.push(k),f.push(R),f.push(T)}else for(var b=Cesium.Math.toRadians(a.x),z=Cesium.Math.toRadians(i[0].x),B=Cesium.Math.toRadians(a.y),E=Cesium.Math.toRadians(i[0].y),l=0;l<v;++l){var R=Cesium.Math.lerp(a.x,i[0].x,l/(v-1)),T=Cesium.Math.lerp(a.y,i[0].y,l/(v-1)),I=Cesium.Math.lerp(b,z,l/(v-1)),V=Cesium.Math.lerp(B,E,l/(v-1)),k=new Cesium.Cartographic(I,V);P.push(k),f.push(R),f.push(T)}}),r.terrainProvider._layers){var O=Cesium.sampleTerrainMostDetailed(r.terrainProvider,P);Promise.all([O]).then(a=>{console.log(a[0]),a=a[0];for(let c=0;c<a.length;c++)_.push(a[c].height),D.push(s[0]-t.height);r.entities.add({id:"entityDMBJ",wall:{positions:Cesium.Cartesian3.fromDegreesArray(f),maximumHeights:_,minimumHeights:D,material:new Cesium.ImageMaterialProperty({image:t.side,repeat:new Cesium.Cartesian2(30,30)})}})})}else{for(let a=0;a<P.length;a++)_.push(0),D.push(s[0]-t.height);r.entities.add({id:"entityDMBJ",wall:{positions:Cesium.Cartesian3.fromDegreesArray(f),maximumHeights:_,minimumHeights:D,material:new Cesium.ImageMaterialProperty({image:t.side,repeat:new Cesium.Cartesian2(30,30)})}})}}isClockWise(e){if(e.length<3)return null;e[0]===e[e.length-1]&&(e=e.slice(0,e.length-1));let i={i:-1,val:1e8};for(let n=0;n<e.length;n++){let C=e[n].y;C<i.val&&(i.val=C,i.i=n)}let r=(i.i+e.length-1)%e.length,t=i.i,m=(i.i+1)%e.length,u={y:e[t].y-e[r].y,x:e[t].x-e[r].x},s={y:e[m].y-e[t].y,x:e[m].x-e[t].x},h=s.x*u.y-u.x*s.y;return h===0?e[m].x<e[r].x:h>0}}const ie={__name:"potholing",setup(J){const{viewer:e}=window,i=U(30),r=[{x:-2.4097286420393116e6,y:4694838793290997e-9,z:3570221295666795e-9},{x:-2.4097882788523836e6,y:4694808716559992e-9,z:3570220598452356e-9},{x:-2409813389689466e-9,y:4694859279606352e-9,z:3.5701377191554685e6},{x:-2.4097557791936737e6,y:4694886737790491e-9,z:3.5701404776008143e6}];G(()=>{t()});async function t(){e.scene.debugShowFramesPerSecond=!0,e.camera.flyTo({destination:new Cesium.Cartesian3.fromDegrees(117.170434,34.259184,1e3)}),e.terrainProvider=await Cesium.createWorldTerrainAsync({requestVertexNormals:!0}),e.scene.globe.depthTestAgainstTerrain=!0}function m(){u(),new $(e,{positions:r,height:Number(i.value),bottom:"/cesium-vue3-vite/images/excavationregion_top.jpg",side:"/cesium-vue3-vite/images/excavationregion_side.jpg"})}function u(){e&&(e.scene.globe.clippingPlanes&&(e.scene.globe.clippingPlanes=void 0),e.entities.removeById("entityDM"),e.entities.removeById("entityDMBJ"))}return(s,h)=>{const n=Y,C=X;return K(),Q(Z,{style:{display:"flex","flex-direction":"row",gap:"5px"}},{default:H(()=>[N(n,{type:"number",modelValue:i.value,"onUpdate:modelValue":h[0]||(h[0]=d=>i.value=d),placeholder:"\u6316\u6D1E\u6DF1\u5EA6"},null,8,["modelValue"]),N(C,{type:"primary",onClick:m},{default:H(()=>h[1]||(h[1]=[F("\u5F00\u59CB\u6316\u6D1E")])),_:1}),N(C,{type:"danger",onClick:u},{default:H(()=>h[2]||(h[2]=[F("\u6E05\u9664")])),_:1})]),_:1})}}};export{ie as default};
